function SaveCustomEmail(e){var a=e.parent().find(".check-icon"),t=e.parent().find(".cross-icon");t.hide(),a.hide();var s=e.data("order"),i=e.val(),o=e.data("url");jQuery.ajax({type:"POST",url:o,method:"POST",data:{order:s,email:i},success:function(e){"ok"==e.result?(a.show(),a.delay(2e3).fadeOut(300)):t.show()},error:function(e){t.show()},dataType:"json"})}var globalCheckSign='<span class="ssp-success-check">âœ”</span>',globalFilesToCheck=phpVars.filesToCheck,issuesBox='<div id="issues-modal" class="modal fade" tabindex="-1" style="top:80px;" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header" style="height: 15px; padding-top: 0px;"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4>Artwork Issues</h4></div><div class="modal-body"><form id="artwork-issues-form" style="margin-bottom:0px !important;" data-order="" action="'+phpVars.thisDomain+'/api/artwork-issues/" method="POST"><div class="control-group"><div class="controls"><label class="checkbox artwork-issue"><input type="checkbox" class="issue-option" name="issues[resolution]">Low resolution</label><label class="checkbox artwork-issue"><input type="checkbox" class="issue-option" name="issues[bleed]">No bleed </label><label class="checkbox artwork-issue"><input type="checkbox" class="issue-option" name="issues[color]">Color mode</label><label class="checkbox artwork-issue"><input type="checkbox" class="issue-option" name="issues[layout]">Image layout</label><label class="checkbox artwork-issue"><input type="checkbox" class="issue-option" name="issues[fonts]">Fonts issues</label><label class="checkbox artwork-issue"><input type="checkbox" class="issue-option" name="issues[format]">File format</label><label class="checkbox artwork-issue" style="margin-top: 7px;"><input id="custom-issue-checkbox" class="issue-option" type="checkbox" name="issues[custom]">Custom issue:</label><textarea rows="2" style="width:98%; margin-top:-5px; margin-bottom: 10px;" id="custom-issue-text" name="custom-issue" disabled="true"></textarea></div></div></form></div><div class="modal-footer" style="margin-top:-15px; padding:10px 0 5px 0;"><p class="text-center"><button type="submit" id="submit-issues" class="btn btn-info btn-large btn-redirect">Send mail</button></p></div></div></div></div>';jQuery(function(e){e("a.ssp_trigger").on("click",function(){var a=e(this).attr("data-id");e("#ssp_order_info_"+a).slideToggle(200)})}),jQuery(document).ready(function(e){function a(){return e(".file-status")}function t(a){for(var t=a.find(".pseudo-input.item"),s={nomail:a.find(".nomail-val").data("value"),items:[]},i=a.data("action"),o=0;o<t.length;++o){var n=e(t[o]).data("value");s.items.push(n)}var l;l=s.nomail?a.find(".loader-box.approval-nomail"):a.find(".loader-box.approval-mail"),l.html(phpVars.ajaxLoader),l.show(),jQuery.ajax({type:"POST",method:"POST",url:i,data:s,success:function(a){"ok"==a.result?(l.html(globalCheckSign),l.children().delay(500).fadeOut(300),t.each(function(){if(e(this).hasClass("item")){e(".item-selector.belongs-to-item-"+e(this).data("value")).click();var a=e(".file-status.belongs-to-item-"+e(this).data("value"));a.each(function(){"ready"==e(this).html()&&e(this).removeClass("label-info").addClass("label-warning").html("approval")})}})):(l.html("<span>"+a.message+"</span>"),l.children().delay(500).fadeOut(300))},error:function(e){e.message?l.html("<span>"+e.message+"</span>"):(l.html("<span>Server error</span"),l.children().delay(500).fadeOut(300))},dataType:"json"})}setInterval(function(){var t=[],s={},i=[],o=0,n=[],l=a();l.each(function(){if("approval"==e(this).html()||"converting"==e(this).html()||"issues"==e(this).html()||"downloading"==e(this).html()||"ready"==e(this).html()||"not approved"==e(this).html()){fileId=e(this).data("file-id"),fileStatus=e(this).html(),t.push(fileId),s[fileId]=fileStatus,i[fileId]=e(this),o++}else e(this).hasClass("missing")&&n.push(e(this).data("item-id"))}),n.length&&(jQuery.ajax({type:"GET",url:phpVars.thisDomain+"/api/get-uploaded-files",method:"GET",data:{items:n},success:function(a){if("ok"==a.result)for(var t=0;t<a.count;++t){var s=a.files[t].status;console.log(s),statusSpan=e(".belongs-to-item-"+a.files[t].itemId+"."+a.files[t].side),statusSpan.removeClass("missing"),statusSpan.data("file-id",a.files[t].id);var i=statusSpan.parent().parent();i.find(".proof-file-name").html(a.files[t].name).attr("href",phpVars.thisDomain+"/file/"+a.files[t].id),i.find(".proof-file-size").html(a.files[t].size),i.find(".file-remove").data("action",phpVars.thisDomain+"/api/remove/"+a.files[t].id),i.find(".reset-button").data("action",phpVars.thisDomain+"/api/reset-file-status/"+a.files[t].id),"approved"==s?statusSpan.html("approved").addClass("label-success"):"ready"==s?statusSpan.html("ready").addClass("label-info"):"not approved"==s?statusSpan.html("not approved").addClass("label-danger"):"converting"==s?statusSpan.html("converting").addClass("label-default"):"downloading"==s&&statusSpan.html("downloading").addClass("label-default")}else console.log("weird")},error:function(e){},dataType:"json"}),jQuery.ajax({type:"GET",url:phpVars.thisDomain+"/api/check-file-statuses",method:"GET",data:{files:t},success:function(e){if("ok"==e.result){console.log("check ok");for(var a=0;o>a;++a){var t=e.statuses[a].status;if(statusSpan=i[e.statuses[a].id],t!=s[e.statuses[a].id]&&statusSpan.data("file-id")==e.statuses[a].id){if(console.log("Status chengd"),console.log("file id: "+statusSpan.data("file-id")),console.log(t),statusSpan.attr("class",statusSpan.attr("class").replace(/\blabel-[^ ]+\b/g,"")),e.statuses[a].comment&&statusSpan.parent().parent().after('<div class="row comment-row"><div class="col-xs-12" style="padding:0;"><div class="comment-box">'+e.statuses[a].comment+"</div></div></div>"),e.statuses[a].newFile&&("archived"==t||"upload_backup"==t)){var n=e.statuses[a].newFile,l=statusSpan.parent().parent();l.find(".proof-file-name").html(n.name).attr("href",phpVars.thisDomain+"/file/"+n.id),l.find(".proof-file-size").html(n.size),l.find(".file-remove").data("action",phpVars.thisDomain+"/api/remove/"+n.id),l.find(".reset-button").data("action",phpVars.thisDomain+"/api/reset-file-status/"+n.id),statusSpan.data("file-id",n.id),t=n.status,console.log("New id:"+n.id),console.log("New status:"+t)}"approval"==t&&statusSpan.html("approval").addClass("label-warning"),"approved"==t?statusSpan.html("approved").addClass("label-success"):"ready"==t?(statusSpan.html("ready").addClass("label-info"),statusSpan.parent().parent().parent().find(".comment-row").remove()):"not approved"==t?statusSpan.html("not approved").addClass("label-danger"):"converting"==t?(statusSpan.html("converting").addClass("label-default"),statusSpan.parent().parent().parent().find(".comment-row").remove()):"downloading"==t?(statusSpan.html("downloading").addClass("label-default"),statusSpan.parent().parent().parent().find(".comment-row").remove()):statusSpan.html("archived")}else console.log("Status for file "+e.statuses[a].id+" din not change")}}else console.log("weird")},error:function(e){},dataType:"json"}))},3500),e(".fileupload").each(function(){e(this).fileupload({dataType:"json",submit:function(e,a){a.context.find(".abort-icon").fadeIn(150).on("click",function(){a.abort()})},progress:function(e,a){var t=Math.floor(a.loaded/a.total*100);a.context.find(".upload-messages").html(t+"%")},always:function(e,a){a.context.find(".abort-icon").hide()},done:function(e,a){a.context&&a.context.find(".upload-messages").html("OK")},fail:function(e,a){"abort"==a.errorThrown?a.context.find(".upload-messages").html("aborted"):"Request Entity Too Large"==a.errorThrown&&a.context.find(".upload-messages").html("too big")}}).on("fileuploadadd",function(a,t){var s=e("<form></form>",{action:e(this).data("action"),method:"POST",enctype:"multipart/form-data"}),i=e(this).parent(),o=e("<input />",{name:"MAX_FILE_SIZE",value:i.find(".MAX_FILE_SIZE").data("value")});o.appendTo(s),fileInput=i.find(".file"),fileInput.name="files[]",fileInput.appendTo(s);var n=e("<input />",{name:"side[]",value:i.find(".side").data("value")});n.appendTo(s);var l=e("<input />",{name:"order[]",value:i.find(".order").data("value")});l.appendTo(s);var r=e("<input />",{name:"item[]",value:i.find(".item").data("value")});r.appendTo(s);var d=e("<input />",{name:"admin[]",value:1});d.appendTo(s),t.form=s,t.context=e(this)})}),e("body").append(issuesBox),e(".custom-email").keypress(function(a){"13"==a.which&&(a.preventDefault(),SaveCustomEmail(e(this)))}),e(".item-selector").on("click",function(){var a=jQuery(this).data("item"),t=e(this).data("order"),s="#approvalform_"+t,i=e(s).find(".btn"),o=e("#artwork-issues-form");o.data("order")!=t&&(o.data("order",t),e(".item-issue").remove()),"0"==e(this).data("selected")?(e(this).data("selected","1"),e(s).append('<div class="pseudo-input item" id="mail-'+a+'" data-value="'+a+'" ></div>'),e(o).append('<input type="hidden" name="items[]" class="item-issue" id="issue-'+a+'" value="'+a+'" />')):(e(s).find("#mail-"+a).remove(),e(o).find("#issue-"+a).remove(),e(this).data("selected","0")),e(s).find(".item").size()>0?e(i).removeClass("disabled"):i.addClass("disabled")}),e(".proof-approval-mail").on("click",function(a){a.preventDefault(),t(e(this).parent())}),e(".nomail").click(function(a){a.preventDefault(),e(this).hasClass("disabled")||e(this).parent().find(".nomail-val").data("value",1),t(e(this).parent())}),e(".reset-button").on("click",function(a){a.preventDefault();var t=e(this),s=e(this).next();s.html(phpVars.ajaxLoader),s.show(),jQuery.ajax({type:"POST",method:"POST",url:e(this).data("action"),success:function(a){s.html("");var i=e(t).parent().parent();if("ok"==a.result){var o=i.find(".file-status");o.attr("class",o.attr("class").replace(/\blabel-[^ ]+\b/g,"")),o.html("ready").addClass("label-info")}},error:function(e){s.html(""),console.log("error")},dataType:"json"})}),e(".file-remove").on("click",function(a){a.preventDefault();var t=e(this).data("action"),s=e(this).next();s.html(phpVars.ajaxLoader),s.show();var i=e(this);jQuery.ajax({type:"POST",method:"POST",url:t,success:function(e){s.html(""),i.parent().parent().find(".proof-file-name").html("no file").attr("href",""),i.parent().parent().find(".proof-file-size").html(""),i.parent().parent().find(".file-status").addClass("removed"),i.parent().parent().find(".file-status").addClass("missing")},error:function(e){s.html("")},dataType:"json"})}),e(".proof-allow-uploads").on("click",function(a){a.preventDefault();var t=e(this).data("action"),s=e(this).next();s.html(phpVars.ajaxLoader),s.show(),jQuery.ajax({type:"POST",method:"POST",url:t,success:function(e){console.log(globalCheckSign),s.html(globalCheckSign),s.children().delay(500).fadeOut(300)},error:function(e){s.html("error")},dataType:"json"})}),e("#submit-issues").click(function(a){a.preventDefault();var t=e("#artwork-issues-form"),s=t.serialize();jQuery.ajax({type:"POST",method:"POST",url:t.attr("action"),data:s,success:function(a){e("#issues-modal").modal("hide"),t.find("input.item").each(function(){var a=e(this).val(),t=e(".file-status.belongs-to-item-"+a);t.attr("class",t.attr("class").replace(/\blabel-[^ ]+\b/g,"")),t.html("issues").addClass("label-default").addClass("label")})},error:function(e){console.log("error")},dataType:"json"})}),e(".artwork-issues-link").click(function(a){a.stopImmediatePropagation();var t=e(this).parent().parent().find(".item-selector"),s=t.data("item");t.parent().parent().find(".item-selector").each(function(){"1"==e(this).data("selected")&&e(this).click()}),e(".item-issue").remove();var i=e("#artwork-issues-form");e("#issues-modal").modal("show"),e(i).append('<input type="hidden" class="item item-issue" id="mail-'+s+'" name="items[]" value="'+s+'" />')}),e("#custom-issue-checkbox").on("click",function(){var a=e("#custom-issue-text").prop("disabled");e("#custom-issue-text").prop("disabled",!a)}),e("#issues-modal").on("hidden",function(){e(".issue-option").prop("checked",!1),e("#custom-issue-text").prop("disabled",!0).val(""),e(".item-issue").remove(),e(".item-selector").each(function(){"1"==e(this).data("selected")&&e(this).click()})}),e("#issues-modal").on("shown",function(){e(".issue-option").prop("checked",!1),e("#custom-issue-text").prop("disabled",!0).val("")}),e(".history-view").click(function(){"Order history"==e(this).html()?(e(this).html("Hide history"),e(this).next().slideDown(300)):(e(this).html("Order history"),e(this).next().slideUp(300))})});